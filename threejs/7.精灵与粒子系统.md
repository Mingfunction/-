# 7.ç‚¹æè´¨

```js
    let container = document.getElementById("container");
    console.log(container);
    let innerHeight = container.clientHeight;
    let innerWidth = container.clientWidth;

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(
      75,
      innerWidth / innerHeight,
      0.1,
      1000
    );

    scene.add(camera);
    camera.position.set(0, 5, 10);

    const axesHelper = new THREE.AxesHelper(100);
    scene.add(axesHelper);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(innerWidth, innerHeight);
    // æ¸²æŸ“å™¨å¼€å¯é˜´å½±
    renderer.shadowMap.enabled = true;
    container.appendChild(renderer.domElement);
    const controls = new OrbitControls(camera, renderer.domElement);

    function renderer3D() {
      controls.update();
      renderer.render(scene, camera);
      requestAnimationFrame(renderer3D);
    }
    renderer3D();

    //åˆ›å»ºçƒå‡ ä½•ä½“
    const sphereGeometry = new THREE.SphereBufferGeometry(1, 20, 20);
    const material = new THREE.MeshBasicMaterial({
      color: "#ff0000",
      wireframe: true,
    });
    const sphere = new THREE.Mesh(sphereGeometry, material);
    sphere.castShadow = true;
    scene.add(sphere);

```

é¦–å…ˆä½¿ç”¨ä¹‹å‰çš„ä»£ç åˆ›å»ºä¸€ä¸ªçƒä½“ ä½¿ç”¨MeshBasicMaterial å¹¶è®¾ç½®wireframe: true,è®©çƒä½“ä»¥ç½‘æ ¼çš„å½¢çŠ¶ç”Ÿæˆ

ä¹‹åä¿®æ”¹ä»£ç å°†Mesh æ”¹æˆ points
```js

    const sphereGeometry = new THREE.SphereBufferGeometry(1, 20, 20);
    const material = new THREE.MeshBasicMaterial({
      color: "#ff0000",
      wireframe: true,
    });
    const sphere = new THREE.Points(sphereGeometry, material);
    sphere.castShadow = true;
    scene.add(sphere);
```
<img src="./blogImg/warframeSphere.png" width="200">
<img src="./blogImg/pointSphere.png" width="250">

ç¬¬äºŒå¼ çœ‹ä¸æ¸…å¯ä»¥æ”¾å¤§ç‚¹çœ‹

å†ä¿®æ”¹Materialæè´¨ å˜æˆ PointsMaterial
```js
// å…ˆä¸ä¼ å…¥å‚æ•°è¯•è¯•
const sphereGeometry = new THREE.SphereBufferGeometry(1, 20, 20);
const PointMaterial = new THREE.PointsMaterial({
  // color: "#ff0000",
  // wireframe: true,
});
// PointMaterial.size = 0.01 ä¹‹åå†å¼€å¯è¿™è¡Œä»£ç 
const sphere = new THREE.Points(sphereGeometry, PointMaterial);
sphere.castShadow = true;
scene.add(sphere);
```
<img src="./blogImg/pointsMaterial.png" width="250">

è¿™æ˜¯ä¸ªä»€ä¹ˆé¬¼ä¸œè¥¿ï¼Ÿ

å…¶å®æ˜¯ä¸€ä¸ªä¸ªæ­£æ–¹å½¢å åŠ åœ¨ä¸€èµ· æˆ‘ä¸Šé¢è®¾ç½®çš„ SphereBufferGeometry åŠå¾„æ‰1
è€Œ PointMaterial é»˜è®¤çš„sizeå°±æ˜¯0.01æ‰€ä»¥ä¼šè¿™æ ·

é‚£ä¹ˆæ·»åŠ  PointMaterial.size = 0.01 å°±æ­£å¸¸äº† è¿™æ ·çœ‹æ¸…ä¹‹åæ¯ä¸ªç²’å­éƒ½æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢

<img src="./blogImg/pointSphere.png" width="250">

è®¾ç½®ç‚¹æè´¨çš„å…¶ä»–å±æ€§

.color : Color
æè´¨çš„é¢œè‰²(Color)ï¼Œé»˜è®¤å€¼ä¸ºç™½è‰² (0xffffff)ã€‚
.sizeAttenuation : Boolean
æŒ‡å®šç‚¹çš„å¤§å°æ˜¯å¦å› ç›¸æœºæ·±åº¦è€Œè¡°å‡ã€‚ï¼ˆä»…é™é€è§†æ‘„åƒå¤´ã€‚ï¼‰é»˜è®¤ä¸ºtrueã€‚
ç²’å­ç¦»æˆ‘ä»¬è¶Šè¿‘è¶Šå¤§ è®¾ç½®false å°±æ˜¯æ— è§†è·ç¦»éƒ½ä¸€æ ·å¤§
ä¸€èˆ¬éƒ½æ˜¯true

ä¸ºpointsæ·»åŠ çº¹ç†
```js
const textureLoader = new THREE.TextureLoader();
const pointTexture = textureLoader.load("./textures/particles/1.png");
//åˆ›å»ºçƒå‡ ä½•ä½“
const sphereGeometry = new THREE.SphereBufferGeometry(2, 20, 20);
const pointMaterial = new THREE.PointsMaterial({
  color: "#ff0000",
  map: pointTexture,
});
pointMaterial.size = 0.05;
// pointMaterial.map = pointTexture;
// pointMaterial.sizeAttenuation = false;
const points = new THREE.Points(sphereGeometry, pointMaterial);
scene.add(points);
```
è¿™æ ·ç²’å­å°±ä¸æ˜¯å•è°ƒçš„æ­£æ–¹å½¢äº† è€Œæ˜¯å›¾ç‰‡çš„æ ·å¼
ä½†æ˜¯ç‚¹æœ‰ä¸ªé—®é¢˜æ˜¯ å›¾ç‰‡çš„é»‘è¾¹ä¼šæŒ¡ä½è¾…åŠ©çº¿ å½“ç„¶ä¹Ÿä¼šæŒ¡ä½ä¸€äº›å…¶ä»–çš„ä¸œè¥¿ 
<img src="./blogImg/points_bug.png" width="250">

æ‰€ä»¥éœ€è¦è®¾ç½®é€æ˜ é€æ˜çº¹ç†ï¼Œå’Œä¹‹å‰é—¨çš„çº¹ç†åŸç†ä¸€æ ·é»‘è‰²çš„éƒ¨åˆ†æ˜¯é€æ˜çš„

```js
const pointMaterial = new THREE.PointsMaterial({
  color: "#ff0000",
  map: pointTexture,
  transparent: true,
  alphaMap: pointTexture,
});
```
è¿™å¥½æˆ‘è¿™å¼ å›¾è¾¹ä¸Šå°±æ˜¯é»‘çš„æ‰€ä»¥å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ ğŸ˜„ ğŸ˜„ ğŸ˜„ 

ä½†æ˜¯åé¢çš„ç‚¹å´è¿˜æ˜¯è¢«æŒ¡ä½äº† å› ä¸ºæ˜¯ç›¸æœºè®¤ä¸ºä»–çœ‹åˆ°äº†ä¸€ä¸ªç‰©ä½“ï¼Œè€Œåœ¨å…¶åé¢çš„ç‰©ä½“å°±ä¸ç”¨æ˜¾ç¤ºäº†

éœ€è¦è®¾ç½®Material depthWrite ä¸ºfalse è¿™ä¸ªå±æ€§æ˜¯ç»§æ‰¿è‡ª Material
.depthWrite : Boolean
æ¸²æŸ“æ­¤æè´¨æ˜¯å¦å¯¹æ·±åº¦ç¼“å†²åŒºæœ‰ä»»ä½•å½±å“ã€‚é»˜è®¤ä¸ºtrueã€‚

ä½†æ˜¯å´åˆæœ‰ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ åé¢çš„å±…ç„¶ä¼šæœ‰å°é»‘è¾¹
<img src="./blogImg/depthWrite.png" width="250">

```js
const pointMaterial = new THREE.PointsMaterial({
  color: "#ff0000",
  map: pointTexture,
  transparent: true,
  alphaMap: pointTexture,
  depthWrite: false,
  blending: THREE.AdditiveBlending, // è®¾ç½®è¿™ä¸ª
});

```
.blending : Blending
åœ¨ä½¿ç”¨æ­¤æè´¨æ˜¾ç¤ºå¯¹è±¡æ—¶è¦ä½¿ç”¨ä½•ç§æ··åˆã€‚ é»˜è®¤æ˜¯ THREE.NormalBlending 
åœ¨é¢œè‰²ç›¸åŒæ—¶ ç”¨ä»€ä¹ˆæ··åˆæ¨¡å¼æ··åˆ

http://localhost:8080/docs/index.html#api/zh/constants/Materials
æ··åˆç±»å‹
THREE.NoBlending
THREE.NormalBlending
THREE.AdditiveBlending ç›¸åŠ æ··åˆ
THREE.SubtractiveBlending
THREE.MultiplyBlending ç›¸ä¹˜æ··åˆ
THREE.CustomBlending

è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨æ··åˆ AdditiveBlending MultiplyBlending

### æ˜Ÿç©ºæ¡ˆä¾‹ä¸€

```js
    let container = document.getElementById("container");
    console.log(container);
    let innerHeight = container.clientHeight;
    let innerWidth = container.clientWidth;

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(
      75,
      innerWidth / innerHeight,
      0.1,
      1000
    );

    scene.add(camera);
    camera.position.set(0, 5, 5);

    const axesHelper = new THREE.AxesHelper(100);
    scene.add(axesHelper);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(innerWidth, innerHeight);
    // æ¸²æŸ“å™¨å¼€å¯é˜´å½±
    renderer.shadowMap.enabled = true;
    container.appendChild(renderer.domElement);
    const controls = new OrbitControls(camera, renderer.domElement);



    const textureLoader = new THREE.TextureLoader();
    const pointTexture = textureLoader.load("./textures/particles/1.png");
    //åˆ›å»ºçƒå‡ ä½•ä½“

    const geometry = new THREE.BufferGeometry();
    const num = 5004;
    const floatArray = new Float32Array(num);
    const colorArray = new Float32Array(num);
    for (let index = 0; index < num; index++) {
      floatArray[index] = Math.random() * 100 - 50;
      colorArray[index] = Math.random();
    }
    geometry.setAttribute("position", new THREE.BufferAttribute(floatArray, 3));
    //  å…‰è®¾ç½® colorè¿˜ä¸å¤Ÿéœ€è¦è®¾ç½® vertexColors  å¯ç”¨é¡¶ç‚¹é¢œè‰²è®¾ç½®
    geometry.setAttribute("color", new THREE.BufferAttribute(colorArray, 3));

    const pointMaterial = new THREE.PointsMaterial({
      // color: "#ff0000",
      map: pointTexture,
      transparent: true,
      alphaMap: pointTexture,
      depthWrite: false,
      blending: THREE.AdditiveBlending,
      // å¯ç”¨é¡¶ç‚¹é¢œè‰²è®¾ç½®
      vertexColors: true,
    });
    pointMaterial.vertexColors = true;
    pointMaterial.size = 1;
    const points = new THREE.Points(geometry, pointMaterial);
    scene.add(points);


    function renderer3D() {
      // 
      // points.rotation.x = Date.now()
      controls.update();
      renderer.render(scene, camera);
      requestAnimationFrame(renderer3D);
    }
    renderer3D();
```



